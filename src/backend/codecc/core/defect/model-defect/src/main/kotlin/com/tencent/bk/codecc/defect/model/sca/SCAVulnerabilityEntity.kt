package com.tencent.bk.codecc.defect.model.sca

import com.tencent.bk.codecc.defect.model.defect.LintDefectV2Entity
import com.tencent.bk.codecc.defect.model.sca.sbom.SbomPackageBase
import org.springframework.data.mongodb.core.index.CompoundIndex
import org.springframework.data.mongodb.core.index.CompoundIndexes
import org.springframework.data.mongodb.core.mapping.Document
import org.springframework.data.mongodb.core.mapping.Field
import org.springframework.data.mongodb.core.mapping.Sharded

@CompoundIndexes(
    CompoundIndex(
        name = "idx_task_id_1_tool_name_1_vulnerability_ids_1",
        def = "{'task_id':1, 'tool_name':1, 'vulnerability_ids':1}",
        background = true
    ),
)
@Sharded(shardKey = ["task_id"])
@Document(collection = "t_sca_vulnerability")
class SCAVulnerabilityEntity(
    /**
     * 状态
     */
    @Field("has_enabled_package")
    var hasEnabledPackage: Boolean? = true,
    /**
     * 组件名
     */
    @Field("package_name")
    var packageName: String? = null,
    /**
     * 最大影响版本
     */
    @Field("package_max_version")
    var packageMaxVersion: String? = null,
    /**
     * 最大影响版本是否包含
     */
    @Field("max_version_inclusive")
    var maxVersionInclusive: Boolean? = false,
    /**
     * 最小影响版本
     */
    @Field("package_min_version")
    var packageMinVersion: String? = null,
    /**
     * 最小影响版本是否包含
     */
    @Field("min_version_inclusive")
    var minVersionInclusive: Boolean? = false,
    /**
     * 修复版本
     */
    @Field("fix_version")
    var fixVersion: String? = null,
    /**
     * 修复版本是否包含
     */
    @Field("fix_version_inclusive")
    var fixVersionInclusive: Boolean = true,
    /**
     * 漏洞ID
     */
    @Field("vulnerability_ids")
    var vulnerabilityIds: List<String>? = emptyList(),
    /**
     * 受影响的组件列表
     */
    @Field("affected_packages")
    var affectedPackages: List<SbomPackageBase>? = emptyList(),
    /**
     * 漏洞详情链接
     */
    @Field("ref_url")
    var refUrl: String? = null,
    /**
     * 漏洞类型
     */
    @Field("vul_type")
    var vulType: String? = null,
    /**
     * 攻击类型
     */
    @Field("attack_type")
    var attackType: String? = null,
    /**
     * 是否可被利用
     */
    @Field("exploitable")
    var exploitable: Boolean? = null,
    /**
     * 漏洞数据更新时间
     */
    @Field("release_date")
    var releaseDate: String? = null,
    /**
     * 预留，当前工具暂未上报cvss评分
     * cvssV3评分
     */
    @Field("cvss_v3")
    var cvssV3: String? = null,
    /**
     * 预留，当前工具暂未上报cvss评分
     * cvssV2评分
     */
    @Field("cvss_v2")
    var cvssV2: String? = null,

) : LintDefectV2Entity()
