package com.tencent.bk.codecc.defect.model.sca

import com.tencent.bk.codecc.defect.model.defect.LintDefectV2Entity
import com.tencent.bk.codecc.defect.model.sca.vulnerability.SCAVulAffectedPackage
import com.tencent.bk.codecc.defect.model.sca.vulnerability.SCAVulnerabilityRating
import com.tencent.bk.codecc.defect.model.sca.vulnerability.SCAVulnerabilitySource
import lombok.EqualsAndHashCode
import org.springframework.data.mongodb.core.index.CompoundIndex
import org.springframework.data.mongodb.core.index.CompoundIndexes
import org.springframework.data.mongodb.core.mapping.Document
import org.springframework.data.mongodb.core.mapping.Field
import org.springframework.data.mongodb.core.mapping.Sharded

@CompoundIndexes(
    CompoundIndex(
        name = "idx_task_id_1_tool_name_1_vulnerability_ids_1",
        def = "{'task_id':1, 'tool_name':1, 'vulnerability_ids':1}",
        background = true
    ),
    CompoundIndex(
        name = "idx_task_id_1_tool_name_1_status_1",
        def = "{'task_id':1, 'tool_name':1, 'status':1}",
        background = true
    ),
    CompoundIndex(
        name = "idx_task_id_1_tool_name_1_package_id_1",
        def = "{'task_id':1, 'tool_name':1, 'package_id':1}",
        background = true
    )
)
@Sharded(shardKey = ["task_id"])
@Document(collection = "t_sca_vulnerability")
@EqualsAndHashCode(callSuper = true)
class SCAVulnerabilityEntity(
    /**
     * 组件名称
     */
    @Field("package_name")
    var packageName: String? = null,
    /**
     * 组件版本
     */
    @Field("package_version")
    var packageVersion: String? = null,
    /**
     * 组件ID
     */
    @Field("package_id")
    var packageId: String? = null,
    /**
     * 漏洞名称
     */
    @Field("name")
    var name: String? = null,
    /**
     * 漏洞ID
     */
    @Field("vulnerability_ids")
    var vulnerabilityIds: List<String>? = emptyList(),
    /**
     * 受影响的组件列表
     */
    @Field("affected_packages")
    var affectedPackages: List<SCAVulAffectedPackage>? = emptyList(),
    /**
     * 漏洞来源列表
     */
    @Field("source")
    var source: List<SCAVulnerabilitySource>? = null,
    /**
     * 漏洞详情链接
     */
    @Field("ref_url")
    var refUrl: String? = null,
    /**
     * 漏洞类型
     */
    @Field("vul_type")
    var vulType: String? = null,
    /**
     * 攻击类型
     */
    @Field("attack_type")
    var attackType: String? = null,
    /**
     * 是否可被利用
     */
    @Field("exploitable")
    var exploitable: Boolean? = null,
    /**
     * 预留，当前工具暂未上报cvss评分
     * cvssV3评分
     */
    @Field("cvss_v3")
    var cvssV3: SCAVulnerabilityRating? = null,
    /**
     * 预留，当前工具暂未上报cvss评分
     * cvssV2评分
     */
    @Field("cvss_v2")
    var cvssV2: SCAVulnerabilityRating? = null,
    /**
     * 漏洞评分
     */
    @Field("ratings")
    var ratings: List<SCAVulnerabilityRating>? = null,
    /**
     * 修改时间
     */
    @Field("modified_date")
    var modifiedDate: Long? = null,
    /**
     * 发布时间
     */
    @Field("published_date")
    var publishedDate: Long? = null

) : LintDefectV2Entity()
